//Так как с API приходит всего один фильм - оставил тестовые данные
// для наглядности.
// const films = ref([{"Title":"Doom","Year":"2005","Rated":"R","Released":"21 Oct 2005","Runtime":"105 min","Genre":"Action, Horror, Sci-Fi","Director":"Andrzej Bartkowiak","Writer":"Dave Callaham, Wesley Strick","Actors":"Karl Urban, Rosamund Pike, Dwayne Johnson","Plot":"Space Marines are sent to investigate strange events at a research facility on Mars but find themselves at the mercy of genetically enhanced killing machines.","Language":"English, Japanese","Country":"United Kingdom, Czech Republic, Germany, United States","Awards":"3 nominations","Poster":"https://m.media-amazon.com/images/M/MV5BOGQ1NzkxOWUtMjc0Ni00MWY0LTk4YjAtODUzN2I2M2QyYzIzXkEyXkFqcGdeQXVyMjQwMjk0NjI@._V1_SX300.jpg","Ratings":[{"Source":"Internet Movie Database","Value":"5.2/10"},{"Source":"Rotten Tomatoes","Value":"18%"},{"Source":"Metacritic","Value":"34/100"}],"Metascore":"34","imdbRating":"5.2","imdbVotes":"117,301","imdbID":"tt0419706","Type":"movie","DVD":"05 Aug 2014","BoxOffice":"$28,212,337","Production":"N/A","Website":"N/A","Response":"True"}, {"Title":"Doom","Year":"2005","Rated":"R","Released":"21 Oct 2005","Runtime":"105 min","Genre":"Action, Horror, Sci-Fi","Director":"Andrzej Bartkowiak","Writer":"Dave Callaham, Wesley Strick","Actors":"Karl Urban, Rosamund Pike, Dwayne Johnson","Plot":"Space Marines are sent to investigate strange events at a research facility on Mars but find themselves at the mercy of genetically enhanced killing machines.","Language":"English, Japanese","Country":"United Kingdom, Czech Republic, Germany, United States","Awards":"3 nominations","Poster":"https://m.media-amazon.com/images/M/MV5BOGQ1NzkxOWUtMjc0Ni00MWY0LTk4YjAtODUzN2I2M2QyYzIzXkEyXkFqcGdeQXVyMjQwMjk0NjI@._V1_SX300.jpg","Ratings":[{"Source":"Internet Movie Database","Value":"5.2/10"},{"Source":"Rotten Tomatoes","Value":"18%"},{"Source":"Metacritic","Value":"34/100"}],"Metascore":"34","imdbRating":"5.2","imdbVotes":"117,301","imdbID":"tt0419706","Type":"movie","DVD":"05 Aug 2014","BoxOffice":"$28,212,337","Production":"N/A","Website":"N/A","Response":"True"}, {"Title":"Doom","Year":"2005","Rated":"R","Released":"21 Oct 2005","Runtime":"105 min","Genre":"Action, Horror, Sci-Fi","Director":"Andrzej Bartkowiak","Writer":"Dave Callaham, Wesley Strick","Actors":"Karl Urban, Rosamund Pike, Dwayne Johnson","Plot":"Space Marines are sent to investigate strange events at a research facility on Mars but find themselves at the mercy of genetically enhanced killing machines.","Language":"English, Japanese","Country":"United Kingdom, Czech Republic, Germany, United States","Awards":"3 nominations","Poster":"https://m.media-amazon.com/images/M/MV5BOGQ1NzkxOWUtMjc0Ni00MWY0LTk4YjAtODUzN2I2M2QyYzIzXkEyXkFqcGdeQXVyMjQwMjk0NjI@._V1_SX300.jpg","Ratings":[{"Source":"Internet Movie Database","Value":"5.2/10"},{"Source":"Rotten Tomatoes","Value":"18%"},{"Source":"Metacritic","Value":"34/100"}],"Metascore":"34","imdbRating":"5.2","imdbVotes":"117,301","imdbID":"tt0419706","Type":"movie","DVD":"05 Aug 2014","BoxOffice":"$28,212,337","Production":"N/A","Website":"N/A","Response":"True"}, {"Title":"Doom","Year":"2005","Rated":"R","Released":"21 Oct 2005","Runtime":"105 min","Genre":"Action, Horror, Sci-Fi","Director":"Andrzej Bartkowiak","Writer":"Dave Callaham, Wesley Strick","Actors":"Karl Urban, Rosamund Pike, Dwayne Johnson","Plot":"Space Marines are sent to investigate strange events at a research facility on Mars but find themselves at the mercy of genetically enhanced killing machines.","Language":"English, Japanese","Country":"United Kingdom, Czech Republic, Germany, United States","Awards":"3 nominations","Poster":"https://m.media-amazon.com/images/M/MV5BOGQ1NzkxOWUtMjc0Ni00MWY0LTk4YjAtODUzN2I2M2QyYzIzXkEyXkFqcGdeQXVyMjQwMjk0NjI@._V1_SX300.jpg","Ratings":[{"Source":"Internet Movie Database","Value":"5.2/10"},{"Source":"Rotten Tomatoes","Value":"18%"},{"Source":"Metacritic","Value":"34/100"}],"Metascore":"34","imdbRating":"5.2","imdbVotes":"117,301","imdbID":"tt0419706","Type":"movie","DVD":"05 Aug 2014","BoxOffice":"$28,212,337","Production":"N/A","Website":"N/A","Response":"True"}, {"Title":"Doom","Year":"2005","Rated":"R","Released":"21 Oct 2005","Runtime":"105 min","Genre":"Action, Horror, Sci-Fi","Director":"Andrzej Bartkowiak","Writer":"Dave Callaham, Wesley Strick","Actors":"Karl Urban, Rosamund Pike, Dwayne Johnson","Plot":"Space Marines are sent to investigate strange events at a research facility on Mars but find themselves at the mercy of genetically enhanced killing machines.","Language":"English, Japanese","Country":"United Kingdom, Czech Republic, Germany, United States","Awards":"3 nominations","Poster":"https://m.media-amazon.com/images/M/MV5BOGQ1NzkxOWUtMjc0Ni00MWY0LTk4YjAtODUzN2I2M2QyYzIzXkEyXkFqcGdeQXVyMjQwMjk0NjI@._V1_SX300.jpg","Ratings":[{"Source":"Internet Movie Database","Value":"5.2/10"},{"Source":"Rotten Tomatoes","Value":"18%"},{"Source":"Metacritic","Value":"34/100"}],"Metascore":"34","imdbRating":"5.2","imdbVotes":"117,301","imdbID":"tt0419706","Type":"movie","DVD":"05 Aug 2014","BoxOffice":"$28,212,337","Production":"N/A","Website":"N/A","Response":"True"}, {"Title":"Doom","Year":"2005","Rated":"R","Released":"21 Oct 2005","Runtime":"105 min","Genre":"Action, Horror, Sci-Fi","Director":"Andrzej Bartkowiak","Writer":"Dave Callaham, Wesley Strick","Actors":"Karl Urban, Rosamund Pike, Dwayne Johnson","Plot":"Space Marines are sent to investigate strange events at a research facility on Mars but find themselves at the mercy of genetically enhanced killing machines.","Language":"English, Japanese","Country":"United Kingdom, Czech Republic, Germany, United States","Awards":"3 nominations","Poster":"https://m.media-amazon.com/images/M/MV5BOGQ1NzkxOWUtMjc0Ni00MWY0LTk4YjAtODUzN2I2M2QyYzIzXkEyXkFqcGdeQXVyMjQwMjk0NjI@._V1_SX300.jpg","Ratings":[{"Source":"Internet Movie Database","Value":"5.2/10"},{"Source":"Rotten Tomatoes","Value":"18%"},{"Source":"Metacritic","Value":"34/100"}],"Metascore":"34","imdbRating":"5.2","imdbVotes":"117,301","imdbID":"tt0419706","Type":"movie","DVD":"05 Aug 2014","BoxOffice":"$28,212,337","Production":"N/A","Website":"N/A","Response":"True"}, {"Title":"Doom","Year":"2005","Rated":"R","Released":"21 Oct 2005","Runtime":"105 min","Genre":"Action, Horror, Sci-Fi","Director":"Andrzej Bartkowiak","Writer":"Dave Callaham, Wesley Strick","Actors":"Karl Urban, Rosamund Pike, Dwayne Johnson","Plot":"Space Marines are sent to investigate strange events at a research facility on Mars but find themselves at the mercy of genetically enhanced killing machines.","Language":"English, Japanese","Country":"United Kingdom, Czech Republic, Germany, United States","Awards":"3 nominations","Poster":"https://m.media-amazon.com/images/M/MV5BOGQ1NzkxOWUtMjc0Ni00MWY0LTk4YjAtODUzN2I2M2QyYzIzXkEyXkFqcGdeQXVyMjQwMjk0NjI@._V1_SX300.jpg","Ratings":[{"Source":"Internet Movie Database","Value":"5.2/10"},{"Source":"Rotten Tomatoes","Value":"18%"},{"Source":"Metacritic","Value":"34/100"}],"Metascore":"34","imdbRating":"5.2","imdbVotes":"117,301","imdbID":"tt0419706","Type":"movie","DVD":"05 Aug 2014","BoxOffice":"$28,212,337","Production":"N/A","Website":"N/A","Response":"True"}, {"Title":"Doom","Year":"2005","Rated":"R","Released":"21 Oct 2005","Runtime":"105 min","Genre":"Action, Horror, Sci-Fi","Director":"Andrzej Bartkowiak","Writer":"Dave Callaham, Wesley Strick","Actors":"Karl Urban, Rosamund Pike, Dwayne Johnson","Plot":"Space Marines are sent to investigate strange events at a research facility on Mars but find themselves at the mercy of genetically enhanced killing machines.","Language":"English, Japanese","Country":"United Kingdom, Czech Republic, Germany, United States","Awards":"3 nominations","Poster":"https://m.media-amazon.com/images/M/MV5BOGQ1NzkxOWUtMjc0Ni00MWY0LTk4YjAtODUzN2I2M2QyYzIzXkEyXkFqcGdeQXVyMjQwMjk0NjI@._V1_SX300.jpg","Ratings":[{"Source":"Internet Movie Database","Value":"5.2/10"},{"Source":"Rotten Tomatoes","Value":"18%"},{"Source":"Metacritic","Value":"34/100"}],"Metascore":"34","imdbRating":"5.2","imdbVotes":"117,301","imdbID":"tt0419706","Type":"movie","DVD":"05 Aug 2014","BoxOffice":"$28,212,337","Production":"N/A","Website":"N/A","Response":"True"}]);

const films = ref([])

export default () => {
  const errorInput = ref("");
  const router = useRouter();

  const getFilms = async (data) => {
    if (data.length > 2) {
      films.value = [];
      errorInput.value = "";
      const { data: newfilms } = await useAsyncData("data", () =>
        $fetch(`https://www.omdbapi.com/?t=${data}&apikey=c5c1710b`),
      );
      // Проверка на потенциальный баг. Приходит всегда один фильм, но может и придти 
      // массив фильмов. 
      if (Array.isArray([newfilms.value])) {
        films.value.push(newfilms.value);
      } else {
        films.value = newfilms.value;
      }
      if (films.value.length > 0) {
        router.push({ path: "/catalog" });
      }
    } else {
      errorInput.value = "Введите названиие фильма";
    }
  };
  return {
    films,
    errorInput,
    getFilms,
  };
};
